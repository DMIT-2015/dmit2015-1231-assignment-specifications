= DMIT2015 Assignment 3 - Jakarta Persistence and Integration Testing
:source-highlighter: rouge
:max-width: 90%

== OBJECTIVE
Upon completion of this assignment, you will have demonstrated the ability to:

- Configure the JPA environment to use a database vendor of your choice
- Map a Java class to relational database table using JPA annotations
- Configure JPA to generate database tables for mapped entities
- Perform CRUD operations on a JPA entity using the EntityManager interface
- Perform Integration Testing on a JPA repository using Arquillian

== PROBLEM DESCRIPTION
In this assignment you will design and implement a JPA entity class on a topic of your choice, 
a JPA repository class to manage your JPA entity, and a integration test using Arquillian to verify the operation of your JPA repository.
The entity you design must at mininum contain a unique identifier field, version, createTime, updateTime, 
and three addtional fields and cannot be a topic used in a class demo such as Movie and Todo. 
The identifier field can auto-generated by the database or assigned by your application.
You must Bean Validation annotation to validate for at minimum required field validation.

You can use one of the following database engine for your application:

* H2 Database Engine 
* Oracle Database 23c Free
* SQL Server 2022

=== Docker Containers for SQL Server 2022 and Oracle Database 23c Free
On your VM there are docker containers for SQL Server 2022 and Oracle Database 23c Free which must be manually started when you need to use them.
The following commands can be used to manage the Docker containers.

. To show all running docker containers
[source, console]
----
docker ps
----

. To show docker containers
[source, console]
----
docker ps --all
----

. To start the stopped docker container for SQL Server
[source, console]
----
docker start dmit2015-sqlserver
----

. To stop the running docker container for SQL Server
[source, console]
----
docker stop dmit2015-sqlserver
----

. To start the stopped docker container for Oracle Database 23c Free
[source, console]
----
docker start dmit2015-oracle-free
----

. To stop the running docker container for  Oracle Database 23c Free
[source, console]
----
docker stop dmit2015-oracle-free
----


== GIT REPOSITORY SETUP
. Login to Moodle and navigate to the link to create a private github repository for this assignment.
. Click on *Accept this assignment* to allow github to create a private github repository for you.
. Wait for the *You are ready to go!* messaage then click on the link to navigate to your assignment repository
. Click on *Clone or download* button then copy the URL to your repository to the clipboard.
. You can now clone the git repository to the *~/IdeaProjects/dmit2015-1231-assignment03* folder from IntelliJ IDEA.

== PROJECT SETUP
. Open IntelliJ IDEA and create a new project using the *Jakarta EE* module and change following settings:
 .. Name: `dmit2015-assignment03-yourname`
 .. Location: `~/IdeaProjects/dmit2015-1231-assignment03`
 .. Template: `Web application`
 .. Application server: `<No appliation server>`  
 .. Group: `dmit2015`
 .. Artifact: `assignment03-yourname`
. Click *Next*
. Change the Version select menu to *Jakarta EE 10* and select the following specifications:
 .. Web Profile (10.0.0)
  Click *Create*

. Make the following changes to `pom.xml`
* Change the element value for both `maven.compiler.target` and `maven.compiler.source` to `*17*`.
* Change the element value for `junit.version` to `*5.10.0*`.

poml.xml
[source, xml]
----
<dependency>
    <groupId>org.projectlombok</groupId>
    <artifactId>lombok</artifactId>
    <version>1.18.30</version>
    <scope>provided</scope>
</dependency>

<!-- DataFaker is for creating fake data using a provider -->
<dependency>
    <groupId>net.datafaker</groupId>
    <artifactId>datafaker</artifactId>
    <version>2.0.2</version>
</dependency>

<dependency>
    <groupId>org.hibernate.orm</groupId>
    <artifactId>hibernate-core</artifactId>
    <version>6.3.1.Final</version>
</dependency>
<dependency>
    <groupId>org.hibernate.orm</groupId>
    <artifactId>hibernate-spatial</artifactId>
    <version>6.3.1.Final</version>
</dependency>

<dependency>
    <groupId>com.h2database</groupId>
    <artifactId>h2</artifactId>
    <version>2.2.224</version>
</dependency>

<dependency>
    <groupId>com.microsoft.sqlserver</groupId>
    <artifactId>mssql-jdbc</artifactId>
    <version>11.2.3.jre17</version>
</dependency>

<dependency>
    <groupId>com.oracle.database.jdbc</groupId>
    <artifactId>ojdbc11</artifactId>
    <version>23.2.0.0</version>
</dependency>

<!-- Additional tools to use with Jakarta Faces -->
<dependency>
    <groupId>org.primefaces</groupId>
    <artifactId>primefaces</artifactId>
    <version>13.0.2</version>
    <classifier>jakarta</classifier>
</dependency>
<dependency>
    <groupId>org.webjars.npm</groupId>
    <artifactId>primeflex</artifactId>
    <version>3.3.1</version>
</dependency>
<dependency>
    <groupId>org.omnifaces</groupId>
    <artifactId>omnifaces</artifactId>
    <version>4.3</version>
</dependency>

<dependency>
    <groupId>org.eclipse</groupId>
    <artifactId>yasson</artifactId>
    <version>3.0.3</version>
    <scope>test</scope>
</dependency>
<dependency>
    <groupId>org.jboss.shrinkwrap.resolver</groupId>
    <artifactId>shrinkwrap-resolver-impl-maven</artifactId>
    <version>3.2.1</version>
    <scope>test</scope>
</dependency>
<dependency>
    <groupId>org.jboss.arquillian.junit5</groupId>
    <artifactId>arquillian-junit5-container</artifactId>
    <version>1.7.1.Final</version>
    <scope>test</scope>
</dependency>
<dependency>
    <groupId>org.jboss.arquillian.protocol</groupId>
    <artifactId>arquillian-protocol-servlet-jakarta</artifactId>
    <version>1.7.1.Final</version>
    <scope>test</scope>
</dependency>
<dependency>
    <groupId>org.wildfly.arquillian</groupId>
    <artifactId>wildfly-arquillian-container-managed</artifactId>
    <version>5.0.1.Final</version>
    <scope>test</scope>
</dependency>
<dependency>
    <groupId>org.slf4j</groupId>
    <artifactId>slf4j-api</artifactId>
    <version>2.0.9</version>
    <scope>test</scope>
</dependency>
<dependency>
    <groupId>org.slf4j</groupId>
    <artifactId>slf4j-simple</artifactId>
    <version>2.0.9</version>
    <scope>test</scope>
</dependency>
<dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-core</artifactId>
    <version>2.20.0</version>
    <scope>test</scope>
</dependency>

<dependency>
    <groupId>org.junit.jupiter</groupId>
    <artifactId>junit-jupiter-params</artifactId>
    <version>${junit.version}</version>
    <scope>test</scope>
</dependency>

<dependency>
    <groupId>org.assertj</groupId>
    <artifactId>assertj-core</artifactId>
    <version>3.24.2</version>
    <scope>test</scope>
</dependency>

----

* Add the following dependencies to the `<plugins>` element.

poml.xml
[source, xml]
----
<!-- Plugin to build a bootable JAR for WildFly -->
<plugin>
    <!-- https://docs.wildfly.org/bootablejar/#wildfly_jar_dev_mode -->
    <!-- mvn wildfly-jar:dev-watch -->
    <groupId>org.wildfly.plugins</groupId>
    <artifactId>wildfly-jar-maven-plugin</artifactId>
    <version>10.0.0.Final</version>
    <configuration>
        <feature-pack-location>wildfly@maven(org.jboss.universe:community-universe)#29.0.1.Final</feature-pack-location>
        <layers>
            <!-- https://docs.wildfly.org/29/Bootable_Guide.html#wildfly_layers -->
            <layer>cloud-server</layer> <!-- includes ee-security -->
            <layer>jsf</layer>
        </layers>
        <excluded-layers>
            <layer>deployment-scanner</layer>
        </excluded-layers>
        <plugin-options>
            <jboss-fork-embedded>true</jboss-fork-embedded>
        </plugin-options>
        <!-- https://docs.wildfly.org/bootablejar/#wildfly_jar_enabling_debug -->
        <jvmArguments>
            <!-- https://www.jetbrains.com/help/idea/attaching-to-local-process.html#attach-to-local -->
            <!-- To attach a debugger to the running server from IntelliJ IDEA
                1. From the main menu, choose `Run | Attach to Process`
                2. IntelliJ IDEA will show the list of running local processes. Select the process with the `xxx-bootable.jar` name to attach to.
            -->
            <arg>-agentlib:jdwp=transport=dt_socket,address=8787,server=y,suspend=n</arg>
        </jvmArguments>
    </configuration>
    <executions>
        <execution>
            <goals>
                <goal>package</goal>
            </goals>
        </execution>
    </executions>
</plugin>

<!-- Plugin to run unit tests-->
<!-- mvn test -->
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-surefire-plugin</artifactId>
    <version>3.1.2</version>
</plugin>

<!-- Plugin to run functional tests -->
<!--  mvn failsafe:integration-test -->
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-failsafe-plugin</artifactId>
    <version>3.1.2</version>
</plugin>

----

[start=5]
. Create the following Java packages
.. `dmit2015.config` for Java configuraton classes such as `ApplicationConfig.java`
.. `dmit2015.entity` for Java classes that is mapped to a database
.. `dmit2015.persistence` for Java classes to manage entity classes
.. `dmit2015.faces` for Jakarta Faces backing bean classes

. In the Java package `dmit2015.config`, create a new *DMIT2015 Jakarta Persistence ApplicationConfig* file 
then configure the JTA data source definition for database engine (H2, Oracle, SQL Server) you want to use.

. Navigate to the `src/main/resources/META-INF` folder and delete the existing *persistence.xml* file. 
In the `src/main/resources/META-INF` create a new *DMIT2015 Jakarta Persistence JTA persistence.xml* file then configure the persistence unit 
for the database (H2, Oracle, SQL Server) you want to use.

. Commit and push your project to your GitHub repository.

== REQUIREMENTS
. Design and implement a JPA entity class of a topic of your choice with an id, version, createTime, updateTime, and three additional fields.
The `createTime` is assigned by the system (database or your application) before persisting a entity.
The `updateTime` is assigned by the system (database or your application) before updating a entity.
For example your could design and implement an entity class to manage information on Laptops.

    ----------------------------------------------------
    | Laptop                                            |
    |---------------------------------------------------|
    | id: Long                                          |
    | brand: String                                     |
    | screenSize: BigDecimal                            |
    | processor: String                                 |
    | memoryGB: Integer                                 |
    | hardDriveGB: Integer                              |
    | version: Integer                                  |
    | createTime: LocalDateTime                         |
    | updateTime: LocalDateTime                         |
    |---------------------------------------------------|
    | Laptop() :                                        |
    -----------------------------------------------------

. Create a new JPA respository with methods to perform CRUD (Create, Read One, Read All, Update, Delete) operations on the entity. 
For example, your could create a `LaptopRepository` to manage `Laptop` entities.

. Create a new Integration Test with Arquillian test the methods of your JPA respostiory. 
For example, you could create a `LaptopRepositoryIT` test class for `LaptopRepository`.

. Run your Integration Test and verify that all of your methods in your JPA repository are working as expected.

. Create Jakarta Faces web pages to perform CRUD operations on the entity.

. OPTIONAL CHALLENGE: Change your entity to use a `java.util.UUID` for the unique identifier field instead of a Long.


== CODING REQUIREMENTS
* Java package names must be all lower case (*10%* deduction if you do not follow this requirement)
* Use camelCase for Java variables and method names (*10%* deduction if you do not follow this requirement)
* Use TitleCase for Java class names (*10%* deduction if you do not follow this requirement)
* All Java source files must include javadoc comments before the class with a description of the class, `@author` with your full name, and `@version` with the last date modifed. (*10%* deduction if you do not follow this requirement)

== MARKING GUIDE

[cols="1,4"]
|===
|Mark|Requirement

| 2
| Demonstrate to your instructor that the JPA repository can CREATE a new entity with valid data and fails with invalid data (Bean Validation fails)

| 1
| Demonstrate to your instructor that the JPA resistory can return a list of all entity. 

| 1
| Demonstrate to your instructor that the JPA repository can UPDATE an entity. 

| 1
| Demonstrate to your instructor that the JPA repository can DELETE an entity

| 2
| Demonstrate to your instructor that the Faces web page to create a new entity with valid data and fails with invalid data (Bean Validation fails)

| 1
| Demonstrate to your instructor that the Faces web page can return a list of all entity. 

| 1
| Demonstrate to your instructor that the Faces web page can UPDATE an entity. 

| 1
| Demonstrate to your instructor that the Faces web page can DELETE an entity

|===


== SUBMISSION REQUIREMENTS
* Commit and push your project to your git repository before the due date.
* Demonstrate in person during schedule class the demonstration requirements on or before the first class after the due date.

== Resources
* https://jakarta.ee/specifications/persistence/3.1/jakarta-persistence-spec-3.1.html[Jakarta Persistence]
* https://www.infoworld.com/article/3379043/what-is-jpa-introduction-to-the-java-persistence-api.html[What is JPA?]
* https://assertj.github.io/doc/#assertj-core-assertions-guide[AssertJ Core Assertions Guide]
